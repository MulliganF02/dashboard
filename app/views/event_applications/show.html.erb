<%
=begin%>
  This allows an organizer or admin to sort through applicants with a previous and next applicant button and accept or deny or etc an applicant.
  It includes all the information listed about an applicant and gives an error if the resume file doesnt load.
<%
=end%>

<div class="my-4 my-md-5">
  <div class="container">
    <div class="row">

      <% if admin_or_organizer? %>

        <div class="row align-items-center event-application-nav-button-container">
          <%= link_to 'Previous Applicant',
                      event_application_path(@applicant.id-1),
                      class: 'btn btn-purple event-application-nav-button' %>
          <%= link_to 'Next Applicant',
                      event_application_path(@applicant.id+1),
                      class: 'btn btn-purple event-application-nav-button' %>
        </div>

      <% end %>

      <div class="card">

        <!-- Applicant's Status -->
        <% if @applicant.flag && admin_or_organizer? || 'denied'.eql?(@status)  %>
          <div class="card-status bg-danger"></div>
        <% elsif 'accepted'.eql?(@status) %>
          <div class="card-status bg-success"></div>
        <% elsif 'waitlisted'.eql?(@status) %>
          <div class="card-status bg-warning"></div>
        <% else %>
          <div class="card-status bg-secondary"></div>
        <% end %>

        <div class="card-header event-application-card-padding">
          <h2 class="page-title event-application-page-title-margin-right">
            Application Status:
          </h2>
          <% if @applicant.flag && admin_or_organizer? %>
            <span class="tag tag-danger event-application-header-status-margin">
              Flagged
            </span>
          <% end %>
          <% if @applicant.user.rsvp %>
            <span class="tag tag-success event-application-header-status-margin">
              RSVP
            </span>
          <% end %>
          <% if 'accepted'.eql?(@status) %>
            <span class="tag tag-success event-application-header-status-margin">
              <%= @status.capitalize %>
            </span>
          <% elsif 'denied'.eql?(@status) %>
            <span class="tag tag-danger event-application-header-status-margin">
              <%= @status.capitalize %>
            </span>
          <% elsif 'waitlisted'.eql?(@status) %>
            <span class="tag tag-warning event-application-header-status-margin">
              <%= @status.capitalize %>
            </span>
          <% else %>
            <span class="tag tag-secondary event-application-header-status-margin">
              <%= @status.capitalize %>
            </span>
          <% end %>
        </div>

        <div class="card-body event-application-card-padding">

          <% if admin_or_organizer? %>
            <label class='event-application-required-field event-application-flex-end-container'>
              Required Fields for the Applicant &nbsp;
            </label>
          <% end %>

          <%# HTML Table %>

           <table style="width:30%">
            <tr>
              <td><strong>Name</strong></td>
              <td><%= @applicant.name %></td>

            </tr>
            
            <tr>
              <td><strong>Email</strong></td>
              <td><%= @user.email %></td>
              
            </tr>
            <tr>
              <td><strong>Phone</strong></td>
              <td><%= @applicant.phone.empty? ? 'N/A' : @applicant.phone %></td>
            </tr>

            <tr>
              <td><strong>Age</strong></td>
              <td> <%= @applicant.age %></td>
            </tr>

            <tr>
              <td><strong>Gender</strong></td>
              <td><%= @applicant.gender %></td>
            </tr>

            <tr>
              <td><strong>Pronoun</strong></td>
              <td> <%= @applicant.pronoun %></td>
            </tr>

            <tr>
              <td><strong>Education Level</strong></td>
              <td> <%= @applicant.education_lvl %></td>
            </tr>

            <tr>
              <td><strong>Major</strong></td>
              <td> <%= @applicant.major %></td>
            </tr>


            <tr>
              <td><strong>University</strong></td>
              <td> <%= @applicant.university %></td>
            </tr>
            
            <tr>
              <td><strong>Graduation Year</strong></td>
              <td> <%= @applicant.grad_year %></td>
            </tr>

            <tr>
              <td><strong>Food Restrictions</strong></td>
              <%= @applicant.food_restrictions ? @applicant.food_restrictions_info : 'None' %>
        
            </tr>

            <tr>
              <td><strong>T-Shirt Size</strong></td>
               <%= @applicant.t_shirt_size %>
            </tr>

          </table>  

          <% HackumassWeb::Application::EVENT_APPLICATION_CUSTOM_FIELDS.each do |c| %>
            <p class='required-field'>
            <table>
            
            <label title="<%= c['name'] %>"><b><%= c['label'].truncate(50) %> </b></label>
              <%= @applicant.custom_fields[c['name']] %>
            </table>
            
            </p>
          <% end %>

        </div>

        <% if admin_or_organizer? %>
          <!--
            Only show this field when the applicants disagrees to the
            Term & Conditions but the form is somehow still submitted
          -->
          <% unless @applicant.waiver_liability_agreement and @applicant.mlh_agreement %>
            <p class='required-field'> # Display HackUMass Terms Status
            <span class='event-application-error-text'>
              <label><b>Terms & Condition: </b></label>
              <%= @applicant.waiver_liability_agreement ? 'AGREED' : 'DISAGREED' %>
            </span>
            </p>

            <p class='required-field'> # Display MLH Terms Status
            <span class='event-application-error-text'>
              <label><b>Terms & Condition: </b></label>
              <%= @applicant.mlh_agreement ? 'AGREED' : 'DISAGREED' %>
            </span>
            </p>
          <% end %>
        <% end %>

        <div class="event-application-flex-end-container">
          <% if admin_or_organizer? %>
            <%= button_to 'Accept',
                          {controller: 'event_applications', action: 'status_updated',
                           params: {new_status: 'accepted', id: @applicant.user_id}},
                          {class: 'btn btn-success btn-sm event-application-status-button'} %>

            <%= button_to 'Deny',
                          {controller: 'event_applications', action: 'status_updated',
                           params: {new_status: 'denied', id: @applicant.user_id}},
                          {class: 'btn btn-danger btn-sm event-application-status-button'} %>

            <%= button_to 'Waitlist',
                          {controller: 'event_applications', action: 'status_updated',
                           params: {new_status: 'waitlisted', id: @applicant.user_id}},
                          {class: 'btn btn-warning btn-sm event-application-status-button'} %>
            <% if @application.flag %>
              <%= button_to 'Unflag',
                            {controller: 'event_applications', action: 'unflag_application',
                             params: {application: @application}},
                            {class: 'btn btn-secondary btn-sm event-application-status-button'} %>
            <% else %>
              <%= button_to 'Flag',
                            {controller: 'event_applications', action: 'flag_application',
                             params: {application: @application}},
                            {class: 'btn btn-secondary btn-sm event-application-status-button'} %>
            <% end %>
          <% end %>

          <%= button_to 'Edit', edit_event_application_path(@applicant),
                        {method: 'get', class: 'btn btn-purple btn-sm event-application-status-button'} %>
        </div>

      </div>

      <div class="event-application-resume-container">
        <% if @applicant.resume and @applicant.resume.url %>
          <object width="100%" height="100%" type='application/pdf' data="<%= @applicant.resume.url %>">
            <p>There was error loading the resume, try refreshing the page to see if the
              problem will be resolved. If the issue persists, contact the tech team.</p>
          </object>
        <% else %>
          <b style="color: red">No uploaded resume.</b>
        <% end %>
      </div>

    </div>
  </div>
</div>
